+++
title = 'AoC 2024 5'
date = 2024-12-05T15:21:48+01:00
draft = true
tags = ["aoc"]
+++
Dzisiaj padłem ofiarą przedwczesnych założeń, uznałem że końcowym inputem będą
rządzić te same prawa co testowym, jak się okazało spowolniło mnie to mocno, ale
ostatecznie zadanie i tak udało się rozwiązać.

# Zadanie
Dzisiaj musimy posortować zbiór kartek (oznaczonych liczbami), w taki sposób żeby
nie zaburzyć zasad kolejności drukowania, zasady zdefiniowane są w ten sposób:
```
47|53
97|13
97|61
...
```
Oznacza to że kartka 47 musi być wydrukowana przed 53, a 97 przed 13 i 61.

Następnie dostajemy kilka zbiorów kartek które musimy zdecydować czy są posortowane
w odpowiedniej kolejności czy nie:
```
47,53,97,13,61
13,97,53
...
```
W tym przypadku pierwsza linia kartek jest posortowana w odpowiedniej kolejności a druga
nie (13 nie powinno być przed 97). W wyniku mamy wziąć numery środkowych kartek każdego
poprawnego ciągu i zsumować je.

## Założenia
Całkiem szybko zauważyłem, że input wygląda tak że każda kartka ma zdefiniowane
wszystkie swoje zależności, więc nie musimy bawić się w przechodniość relacji zależności.

Już tłumaczę, kolejność `a, b, c`, w inpucie zapisana będzie w taki sposób:
```
a|b
a|c
b|c
```
Kiedy tak na prawdę druga linijka nie jest potrzebna bo wiedząc że `a|b` i `b|c`,
moglibyśmy wydedukować że `a|c`. Skorzystam z tej dziwności inputu. Założę też że nie
będzie żadnych konfliktów w zależnościach i że da się stworzyć sortowanie.

Dla każdej kartki, stworzymy sobie zbiór jej zależności, później przeiterujemy, po 
wszystkich listach kartek sprawdzając czy każda następna kartka ma w swoich zależnościach
poprzednią kartkę.

## Rozwiązanie
Myślę że `awk` znowu się nada. Jako że plik na początku zawiera listę zależności późnej
jedną pustą linię i listę list kartek, możemy sprytnie zapisać to w awku w taki sposób:
```awk
BEGIN { FS = "|" }  # ustawiamy separator na |
/\|/{ 
    # jeśli gdzieś w lini jest | to jesteśmy w lini z zależnością
}
/^$/ { FS = "," }   # kiedy znajdziemy pustą linię ustawiamy separator na ,
/,/ { 
    # analiza kartek
}
END {
    # wypisanie wyniku
}
```
### Analiza zależności
Używając asocjacyjnych macierzy z `awk` stworzymy sobie *zbiór* zależności dla każdej
kartki. Ustawiamy 1 (*true*), dla każdej zależności w każdej kartce.
```awk
/\|/{
    dependencies[$2][$1] = 1
}
```
Później będziemy mogli wydajnie sprawdzać czy jakaś kartka zależy od innej np.
```awk
if (page1 in dependencies[page2]) ...
```

### Analiza kartek
Tym razem separator jest ustawiony na `,` i możemy łatwo iterować po kartkach w lini, 
sprawdzając czy kolejność jest zachowana.

Końcowo cały kod prezentuje się tak:
```awk
BEGIN { FS = "|" }
/\|/{
    dependencies[$2][$1] = 1
}
/^$/ { FS = "," }
/,/ { 
    for (i = 1; i < NF; i++)
        if (!($(i) in dependencies[$(i+1)])) next
    sum += $(int((NF + 1) / 2))  # wyciągnij środkową kartkę
}
END { print sum }
```
